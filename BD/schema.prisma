// =============================================
//            BASE DE DATOS LERMA (PRISMA)
// =============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

// =============================================
//                 MODELOS
// =============================================

model User {
  id              Int             @id @default(autoincrement())
  nombre          String
  email           String          @unique
  rol             String          @default("usuario")
  fechaCreacion   DateTime        @default(now())

  // Relaciones
  puntosMapa      PuntoMapa[]
  publicaciones   Publicacion[]
  comentarios     Comentario[]
}

model PuntoMapa {
  id          Int       @id @default(autoincrement())
  nombre      String
  descripcion String?
  tipo        String      // contaminación, proyecto, monitoreo…
  lat         Float
  lng         Float
  fecha       DateTime    @default(now())

  // FK
  usuario     User?       @relation(fields: [usuarioId], references: [id])
  usuarioId   Int?
}

model Publicacion {
  id           Int          @id @default(autoincrement())
  titulo       String
  descripcion  String
  estado       String
  lat          Float?
  lng          Float?
  fecha        DateTime      @default(now())

  // FK
  usuario      User?         @relation(fields: [usuarioId], references: [id])
  usuarioId    Int?

  // Relaciones
  comentarios  Comentario[]
  categorias   PublicacionCategoria[]
}

model Comentario {
  id         Int       @id @default(autoincrement())
  contenido  String
  fecha      DateTime  @default(now())

  // FK
  post       Publicacion @relation(fields: [postId], references: [id])
  postId     Int

  usuario    User?       @relation(fields: [usuarioId], references: [id])
  usuarioId  Int?
}

model Alerta {
  id           Int       @id @default(autoincrement())
  tipo         String
  mensaje      String
  nivelRiesgo  String?    // bajo, medio, alto
  estado       String
  datosClima   Json?
  fecha        DateTime   @default(now())
}

model ReporteClimatico {
  id           Int       @id @default(autoincrement())
  estado       String
  temperatura  Float?
  lluvia       Float?
  viento       Float?
  fecha        DateTime   @default(now())
}

model Categoria {
  id           Int       @id @default(autoincrement())
  nombre       String     @unique

  publicaciones PublicacionCategoria[]
}

// RELACIÓN MANY-TO-MANY PUBLICACION <-> CATEGORIA
model PublicacionCategoria {
  publicacionId Int
  categoriaId   Int

  publicacion   Publicacion @relation(fields: [publicacionId], references: [id])
  categoria     Categoria   @relation(fields: [categoriaId], references: [id])

  @@id([publicacionId, categoriaId])
}
